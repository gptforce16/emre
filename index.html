<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</title>
  <style>
    /* Sayfa üzerindeki tüm öğelere yakınlaştırmayı engelle */
    html, body {
      touch-action: none;  /* Bu özellik mobil cihazlarda yakınlaştırmayı engeller */
    }

    body {
      font-family: sans-serif;
      padding: 1rem;
      max-width: 800px;
      margin: auto;
    }
    h2 {
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1rem;
      table-layout: fixed; /* Tabloyu sabitle */
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      word-wrap: break-word; /* Taşma olduğunda alt satıra geçsin */
    }
    th {
      background-color: #f4f4f4;
    }
    input, select {
      width: 100%;
      padding: 6px;
      margin: 5px 0;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    button {
      padding: 8px 12px;
      margin-top: 10px;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .output {
      background: #f9f9f9;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }

    /* Tablo sütun genişliklerini ayarlamak */
    th, td {
      width: 16%; /* Her sütun için genişlik ayarlıyoruz */
    }

    /* Mobil uyumluluk için tabloyu kaydırılabilir yapma */
    @media (max-width: 768px) {
      table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
      }
    }
  </style>
</head>
<body>
  <h2>Su Tesisleri Dairesi Başkanlığı Piezometre Hesaplama Tablosu</h2>

  <!-- Başlık Tablosu -->
  <table>
    <thead>
      <tr>
        <th>Debi (L/s)</th>
        <th>Kot (m)</th>
        <th>Mesafe (m)</th>
        <th>Boru Çapı (mm)</th>
        <th>Atü (bar)</th>
        <th>İşletme Basıncı</th>
      </tr>
    </thead>
    <tbody id="noktalarTablo">
      <!-- Noktalar buraya eklenecek -->
    </tbody>
  </table>

  <!-- Nokta Ekle Butonu -->
  <button onclick="ekleNokta()">Nokta Ekle</button>

  <!-- Hesaplama Butonu -->
  <button onclick="hesapla()">Hesapla</button>

  <script>
    // Boru çapı/atü iç çap tablosu
    const boruTablosu = {
      "110": 96.8, "125": 110.2, "140": 123.4, "160": 141, "180": 158.6,
      "200": 176.2, "225": 198.2, "250": 220.4, "280": 246.8, "315": 277.6,
      "355": 312.8, "400": 352.6, "450": 396.6
    };

    // Nokta ekleme fonksiyonu
    function ekleNokta() {
      const tbody = document.getElementById('noktalarTablo');
      const row = document.createElement('tr');
      
      // Bir üstteki satırdan boru çapı, atü ve debi değerlerini almak
      const boruOnceki = tbody.children.length > 0 ? tbody.children[tbody.children.length - 1].querySelector('.boru').value : '110';
      const atuOnceki = tbody.children.length > 0 ? tbody.children[tbody.children.length - 1].querySelector('.atu').value : '10';
      const debiOnceki = tbody.children.length > 0 ? tbody.children[tbody.children.length - 1].querySelector('.debi').value : '';

      // Kot, mesafe, çap, atü ve debi kutucukları
      row.innerHTML = `
        <td><input type="number" class="debi" value="${debiOnceki}" placeholder="Debi (L/s)" /></td>
        <td><input type="number" class="kot" placeholder="Kot (m)" /></td>
        <td><input type="number" class="mesafe" value="${tbody.children.length === 0 ? 0 : ''}" ${tbody.children.length === 0 ? 'readonly' : ''} /></td>
        <td><select class="boru">
          <option value="110" ${boruOnceki === '110' ? 'selected' : ''}>110</option>
          <option value="125" ${boruOnceki === '125' ? 'selected' : ''}>125</option>
          <option value="140" ${boruOnceki === '140' ? 'selected' : ''}>140</option>
          <option value="160" ${boruOnceki === '160' ? 'selected' : ''}>160</option>
          <option value="180" ${boruOnceki === '180' ? 'selected' : ''}>180</option>
          <option value="200" ${boruOnceki === '200' ? 'selected' : ''}>200</option>
          <option value="225" ${boruOnceki === '225' ? 'selected' : ''}>225</option>
          <option value="250" ${boruOnceki === '250' ? 'selected' : ''}>250</option>
          <option value="280" ${boruOnceki === '280' ? 'selected' : ''}>280</option>
          <option value="315" ${boruOnceki === '315' ? 'selected' : ''}>315</option>
          <option value="355" ${boruOnceki === '355' ? 'selected' : ''}>355</option>
          <option value="400" ${boruOnceki === '400' ? 'selected' : ''}>400</option>
          <option value="450" ${boruOnceki === '450' ? 'selected' : ''}>450</option>
        </select></td>
        <td><select class="atu">
          <option value="10" ${atuOnceki === '10' ? 'selected' : ''}>10</option>
          <option value="16" ${atuOnceki === '16' ? 'selected' : ''}>16</option>
        </select></td>
        <td><input type="number" class="isletme" readonly /></td>
      `;
      tbody.appendChild(row);

      // Sayı alanında virgülü noktaya çevirme
      const inputs = row.querySelectorAll('input[type="number"]');
      inputs.forEach(input => {
        input.addEventListener('input', function() {
          this.value = this.value.replace(',', '.');
        });
      });
    }

    // Hesaplama fonksiyonu
    function hesapla() {
      const rows = document.querySelectorAll('#noktalarTablo tr');
      let toplamYukKaybi = 0;

      rows.forEach(row => {
        const kot = parseFloat(row.querySelector('.kot').value);
        const mesafe = parseFloat(row.querySelector('.mesafe').value);
        const boruSecim = row.querySelector('.boru').value;
        const debi = parseFloat(row.querySelector('.debi').value);
        const atü = parseFloat(row.querySelector('.atu').value);

        // Boru çapı ve iç çapı hesaplama
        const icCap = boruTablosu[boruSecim];

        // Hız hesaplaması (debi L/s, iç çap mm cinsinden)
        const hiz = debi / 1000 / (Math.PI * Math.pow(icCap / 1000 / 2, 2));

        // Yük kaybı hesaplaması
        const yukKaybi = 6.815 * Math.pow((hiz / 150), 1.852) * Math.pow(icCap / 1000, -1.167) * mesafe;

        // Kümülatif yük kaybı
        toplamYukKaybi += yukKaybi;

        // Piezometrik kot ve işletme basıncı hesaplama
        const piezometrikKot = kot - toplamYukKaybi;
        const isletmeBasinc = kot - piezometrikKot;

        // İşletme basıncını metre cinsine çevirmek için bar'ı 0.1 ile çarpıyoruz
        const isletmeBasincMetre = isletmeBasinc * 0.1;

        // Sonuçları ilgili hücrelere yazdırma
        row.querySelector('.isletme').value = isletmeBasincMetre.toFixed(2);
      });
    }
  </script>
</body>
</html>