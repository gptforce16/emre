<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Nokta Hesaplama</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    input, select {
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
    }
  </style>
</head>
<body>
  <h1>Nokta Ekle</h1>
  <table>
    <thead>
      <tr>
        <th>Debi (L/s)</th>
        <th>Kot (m)</th>
        <th>Mesafe (m)</th>
        <th>Boru Çapı (mm)</th>
        <th>Atü (bar)</th>
        <th>Hız (m/s)</th>
        <th>İşletme Basıncı</th>
      </tr>
    </thead>
    <tbody id="noktalarTablo"></tbody>
  </table>
  <button onclick="ekleNokta()">+ Nokta Ekle</button>
  <button onclick="hesapla()">Hesapla</button>

  <script>
    const boruTablosu = {
      "110": 96.8, "125": 110.2, "140": 123.4, "160": 141, "180": 158.6,
      "200": 176.2, "225": 198.2, "250": 220.4, "280": 246.8, "315": 277.6,
      "355": 312.8, "400": 352.6, "450": 396.6
    };

    function ekleNokta() {
      const tbody = document.getElementById('noktalarTablo');
      const row = document.createElement('tr');

      const boruOnceki = tbody.lastElementChild?.querySelector('.boru')?.value || '110';
      const atuOnceki = tbody.lastElementChild?.querySelector('.atu')?.value || '10';
      const debiOnceki = tbody.lastElementChild?.querySelector('.debi')?.value || '';

      row.innerHTML = `
        <td><input type="number" class="debi" value="${debiOnceki}" placeholder="debi" /></td>
        <td><input type="number" class="kot" placeholder="kot" /></td>
        <td><input type="number" class="mesafe" placeholder="mesafe" value="${tbody.rows.length === 0 ? 0 : ''}" ${tbody.rows.length === 0 ? 'readonly' : ''} /></td>
        <td>
          <select class="boru">
            ${Object.keys(boruTablosu).map(boru => `<option value="${boru}" ${boru === boruOnceki ? 'selected' : ''}>${boru}</option>`).join('')}
          </select>
        </td>
        <td>
          <select class="atu">
            <option value="10" ${atuOnceki === '10' ? 'selected' : ''}>10</option>
            <option value="16" ${atuOnceki === '16' ? 'selected' : ''}>16</option>
          </select>
        </td>
        <td><input type="number" class="hiz" readonly /></td>
        <td><input type="text" class="basinc" readonly /></td>
      `;
      tbody.appendChild(row);
    }

    function hesapla() {
      const rows = document.querySelectorAll('#noktalarTablo tr');
      let oncekiKot = 0;
      let toplamMesafe = 0;

      rows.forEach((row, index) => {
        const debi = parseFloat(row.querySelector('.debi').value) || 0;
        const kot = parseFloat(row.querySelector('.kot').value) || 0;
        const mesafe = parseFloat(row.querySelector('.mesafe').value) || 0;
        const boru = row.querySelector('.boru').value;
        const atu = parseFloat(row.querySelector('.atu').value);

        const cap = boruTablosu[boru] / 1000; // mm to metre
        const alan = Math.PI * (cap / 2) ** 2;

        const hiz = debi / 1000 / alan; // L/s to m3/s
        row.querySelector('.hiz').value = hiz.toFixed(2);

        toplamMesafe += mesafe;
        const yukseklikFarki = kot - oncekiKot;
        oncekiKot = kot;

        const basinc = atu - (toplamMesafe * 0.02) - (yukseklikFarki * 0.1);
        row.querySelector('.basinc').value = basinc.toFixed(2) + ' bar';
      });
    }
  </script>
</body>
</html>